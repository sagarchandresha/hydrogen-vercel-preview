{"version":3,"file":"6cf65df1.js","sources":["../../../node_modules/@shopify/hydrogen/dist/esnext/components/Link/Link.client.js"],"sourcesContent":["import React, { useCallback, useEffect, useState } from 'react';\nimport { useLocation } from '../../foundation/Router/BrowserRouter.client';\nimport { createPath } from 'history';\nimport { buildPath, useNavigate } from '../../foundation/useNavigate/useNavigate';\nimport { RSC_PATHNAME } from '../../constants';\nimport { useInternalServerProps } from '../../foundation/useServerProps/use-server-props';\nimport { useBasePath } from '../../foundation/useRouteParams/RouteParamsProvider.client';\n/**\n * The `Link` component is used to navigate between routes. Because it renders an underlying `<a>` element, all\n * properties available to the `<a>` element are also available to the `Link` component.\n * For more information, refer to the [`<a>` element documentation](https://developer.mozilla.org/en-US/docs/Web/HTML/Element/a#attributes).\n */\nexport const Link = React.forwardRef(function Link(props, ref) {\n    const navigate = useNavigate();\n    const location = useLocation();\n    const [_, startTransition] = React.useTransition();\n    const routeBasePath = useBasePath();\n    /**\n     * Inspired by Remix's Link component\n     */\n    const [shouldPrefetch, setShouldPrefetch] = useState(false);\n    const [maybePrefetch, setMaybePrefetch] = useState(false);\n    const { reloadDocument, target, replace: _replace, onClick, clientState, prefetch = true, scroll = true, } = props;\n    const to = buildPath(props.basePath ?? routeBasePath, props.to);\n    const internalClick = useCallback((e) => {\n        if (onClick)\n            onClick(e);\n        if (!reloadDocument && // do regular browser stuff\n            e.button === 0 && // Ignore everything but left clicks\n            (!target || target === '_self') && // Let browser handle \"target=_blank\"\n            !isModifiedEvent(e) // Ignore modifier key clicks\n        ) {\n            e.preventDefault();\n            // If the URL hasn't changed, the regular <a> will do a replace\n            const replace = !!_replace || createPath(location) === createPath({ pathname: to });\n            navigate(to, {\n                replace,\n                scroll,\n                clientState,\n                basePath: '/', // path was already resolved with the base\n            });\n        }\n    }, [\n        onClick,\n        reloadDocument,\n        target,\n        _replace,\n        location,\n        to,\n        navigate,\n        clientState,\n        scroll,\n    ]);\n    const signalPrefetchIntent = () => {\n        /**\n         * startTransition to yield to more important updates\n         */\n        startTransition(() => {\n            if (prefetch && !!to) {\n                setMaybePrefetch(true);\n            }\n        });\n    };\n    const cancelPrefetchIntent = () => {\n        /**\n         * startTransition to yield to more important updates\n         */\n        startTransition(() => {\n            if (prefetch) {\n                setMaybePrefetch(false);\n            }\n        });\n    };\n    /**\n     * Wrapping `maybePrefetch` inside useEffect allows the user to quickly graze over\n     * a link without triggering a prefetch.\n     */\n    useEffect(() => {\n        if (maybePrefetch) {\n            const id = setTimeout(() => {\n                setShouldPrefetch(true);\n            }, 100);\n            return () => {\n                clearTimeout(id);\n            };\n        }\n    }, [maybePrefetch]);\n    const onMouseEnter = composeEventHandlers(props.onMouseEnter, signalPrefetchIntent);\n    const onMouseLeave = composeEventHandlers(props.onMouseLeave, cancelPrefetchIntent);\n    const onFocus = composeEventHandlers(props.onFocus, signalPrefetchIntent);\n    const onBlur = composeEventHandlers(props.onBlur, cancelPrefetchIntent);\n    const onTouchStart = composeEventHandlers(props.onTouchStart, signalPrefetchIntent);\n    return (React.createElement(React.Fragment, null,\n        React.createElement(\"a\", { ...without(props, [\n                'to',\n                'replace',\n                'clientState',\n                'reloadDocument',\n                'prefetch',\n                'scroll',\n            ]), ref: ref, rel: props.rel ??\n                (to.startsWith('http') || to.startsWith('//')\n                    ? 'noreferrer noopener'\n                    : undefined), onClick: internalClick, onMouseEnter: onMouseEnter, onMouseLeave: onMouseLeave, onFocus: onFocus, onBlur: onBlur, onTouchStart: onTouchStart, href: to }, props.children),\n        shouldPrefetch && React.createElement(Prefetch, { pathname: to })));\n});\nfunction Prefetch({ pathname }) {\n    const { getProposedLocationServerProps } = useInternalServerProps();\n    const location = useLocation();\n    const newPath = createPath({ pathname });\n    if (pathname.startsWith('http') || newPath === createPath(location)) {\n        return null;\n    }\n    const newLocation = new URL(newPath, window.location.href);\n    const proposedServerState = getProposedLocationServerProps({\n        pathname: newLocation.pathname,\n        search: newLocation.search,\n    });\n    const href = `${RSC_PATHNAME}?state=` +\n        encodeURIComponent(JSON.stringify(proposedServerState));\n    return React.createElement(\"link\", { rel: \"prefetch\", as: \"fetch\", href: href });\n}\n/**\n * Credit: Remix's <Link> component.\n */\nexport function composeEventHandlers(theirHandler, ourHandler) {\n    return (event) => {\n        theirHandler?.(event);\n        if (!event.defaultPrevented) {\n            ourHandler(event);\n        }\n    };\n}\nfunction isModifiedEvent(event) {\n    return !!(event.metaKey || event.altKey || event.ctrlKey || event.shiftKey);\n}\nfunction without(obj, props) {\n    const newObj = {};\n    for (const key of Object.keys(obj)) {\n        if (!props.includes(key)) {\n            newObj[key] = obj[key];\n        }\n    }\n    return newObj;\n}\n"],"names":["Link","React","forwardRef","props","ref","navigate","useNavigate","location","useLocation","_","startTransition","useTransition","routeBasePath","useBasePath","shouldPrefetch","setShouldPrefetch","useState","maybePrefetch","setMaybePrefetch","reloadDocument","target","replace","_replace","onClick","clientState","prefetch","scroll","to","buildPath","basePath","internalClick","useCallback","e","button","isModifiedEvent","preventDefault","createPath","pathname","signalPrefetchIntent","cancelPrefetchIntent","useEffect","id","setTimeout","clearTimeout","onMouseEnter","composeEventHandlers","onMouseLeave","onFocus","onBlur","onTouchStart","_jsxs","_Fragment","_jsx","without","rel","startsWith","undefined","children","getProposedLocationServerProps","useInternalServerProps","newPath","newLocation","URL","window","href","proposedServerState","search","RSC_PATHNAME","encodeURIComponent","JSON","stringify","theirHandler","ourHandler","event","defaultPrevented","metaKey","altKey","ctrlKey","shiftKey","obj","newObj","key","Object","keys","includes"],"mappings":"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"}